#!/usr/bin/env bash

cd $(dirname $0)

function getWidthAndHeight() {
  sips --getProperty pixelWidth  "$1" | tail -n 1
  sips --getProperty pixelHeight "$1" | tail -n 1
}

function getAltitude() {
  getWidthAndHeight "$1" | awk '{ if (max < $2) max = $2; } END { print max; }'
}

function padding() {
  local altitude=$(getAltitude $1)
  sips --padToHeightWidth "$altitude" "$altitude" --padColor FFFFFF "$1" | head -n 1
}

function isImage() {
  [[ "$(file $1)" =~ .*image\ data.* ]]
}

for file in $(find . -type f)
do
  if isImage "$file"; then
    padding "$file"
  fi
done

read -p "Press any key to continue..."
